<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Conquer</title>
</head>

<body>
    <center>
        <h1>Conquer</h1>
        <svg width="580" height="400">
            <defs>
                <filter id="fx_offset">
                    <feConvolveMatrix order="4,4" kernelMatrix=" 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0 1" in="SourceAlpha" result="BEVEL" />
                    <feOffset dx="3" dy="3" in="BEVEL" result="OFFSET" />
                    <feMerge>
                        <feMergeNode in="OFFSET" />
                        <feMergeNode in="SourceGraphic" />
                    </feMerge>
                </filter>
                <filter id="fx_offset_red">
                    <feConvolveMatrix order="4,4" kernelMatrix=" 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0 1" in="SourceAlpha" result="BEVEL" />
                    <feOffset dx="3" dy="3" in="BEVEL" result="OFFSET" />
                    <feColorMatrix result="matrixOut" in="OFFSET" type="matrix" values="0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0" />
                    <feMerge>
                        <feMergeNode in="matrixOut" />
                        <feMergeNode in="SourceGraphic" />
                    </feMerge>
                </filter>
            </defs>
            <g>
                <title>WorldMap</title>
                <a id="land_0" onclick="select_land(this)" link='4,3,2,1'>
                    <path id="svg_4" d="m288.333411,280.996194c0,0 -69.330084,-5.999719 -69.676993,-6.3424c0.346909,0.342681 -38.984581,6.3424 -39.33149,5.999719c0.346909,0.342681 -4.319539,23.674921 -4.666448,23.33224c0.346909,0.342682 69.676993,36.340995 69.330084,35.998313c0.346909,0.342682 115.674838,-10.323485 115.327928,-10.666167c0.34691,0.342682 93.675869,17.675203 93.328959,17.332521c0.34691,0.342682 15.012889,-54.988059 14.665979,-55.33074c0.34691,0.342681 -20.318788,-37.655538 -20.665698,-37.998219c0.34691,0.342681 -60.983549,1.675952 -61.330459,1.333271c0.34691,0.342681 -57.650372,27.008098 -57.997282,26.665417c0.346909,0.342681 -38.984581,-0.323954 -38.984581,-0.323954z"
                        fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="#fff" />
                </a>
                <a id="land_1" onclick="select_land(this)" link='0,2,5'>
                    <path id="svg_7" d="m496.9903,134.3364c0,0 -43.331303,27.998688 -43.331303,27.998688c0,0 9.332896,32.665136 8.985986,32.322455c0.34691,0.342681 -48.317476,15.00866 -48.664386,14.665979c0.34691,0.342681 -27.651778,45.007255 -27.651778,45.007255c0,0 60.663824,-0.666635 60.663824,-0.666635c0,0 20.665698,38.664855 20.318788,38.322173c0.34691,0.342681 30.345504,-22.989558 29.998594,-23.33224c0.34691,0.342681 16.346161,-98.319362 15.99925,-98.662042c0.34691,0.342681 -16.318975,-35.655632 -16.318975,-35.655632z"
                        fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="#fff" />
                </a>
                <a id="land_2" onclick="select_land(this)" link='0,3,6,5,1'>
                    <path id="svg_5" d="m312.998922,230.998537l-23.679149,48.321705l37.331584,2.666542l58.663917,-27.998688l29.331959,-44.664573l47.99775,-15.332615l-9.332896,-31.9985l-87.32924,-1.999906l-45.997844,22.665604l-6.98608,48.340432z"
                        fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="#fff" />
                </a>
                <a id="land_3" onclick="select_land(this)" link='4,0,2,6,7'>
                    <path id="svg_3" d="m258.334817,163.668359c0,0 54.664105,67.330178 54.664105,67.330178c0,0 -23.998875,49.997657 -24.345784,49.654976c0.346909,0.342681 -68.983175,-5.657037 -69.330084,-5.999719c0.346909,0.342681 -39.651217,5.675765 -39.998125,5.333083c0.346909,0.342681 7.013263,-41.65535 6.666354,-41.998032c0.346909,0.342681 -26.985144,-20.323017 -27.332052,-20.665698c0.346908,0.342681 34.345315,-50.321611 33.998407,-50.664292c0.346909,0.342681 65.67718,-2.990496 65.67718,-2.990496z"
                        fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="#fff" />
                </a>
                <a id="land_4" onclick="select_land(this)" link='7,3,0'>
                    <path stroke="#000" id="svg_1" d="m70.343627,308.994882c0,0 -5.999719,-95.328866 -5.999719,-95.328866c0,0 67.996813,-17.999156 67.649905,-18.341837c0.346908,0.342681 54.344378,43.007348 53.997469,42.664667c0.346909,0.342681 -10.985894,66.339588 -11.332802,65.996907c0.346909,0.342682 -104.314853,5.00913 -104.314853,5.00913z"
                        fill-opacity="null" stroke-opacity="null" stroke-width="1.5" fill="#fff" />
                </a>
                <a id="land_5" onclick="select_land(this)" link='8,6,2,1'>
                    <path id="svg_8" d="m386.995454,95.671546c0,0 15.99925,34.665042 15.99925,34.665042c0,0 -34.665042,28.665323 -35.011952,28.322643c0.34691,0.342681 86.34288,4.342493 86.34288,4.342493c0,0 42.664667,-28.665323 42.664667,-28.665323c0,0 -0.666635,-28.665323 -1.013546,-29.008004c0.34691,0.34268 -19.652152,-56.987966 -19.999063,-57.330646c0.34691,0.34268 -71.649716,-12.990028 -71.996626,-13.332708c0.34691,0.34268 -16.985611,61.006504 -16.985611,61.006504z"
                        fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="#fff" />
                </a>
                <a id="land_6" onclick="select_land(this)" link='2,3,7,8,5'>
                    <path id="svg_6" d="m366.329756,160.335182c0,0 -45.997844,23.33224 -45.997844,23.33224c0,0 -6.666354,45.997844 -7.013264,45.655163c0.346909,0.342681 -54.983831,-64.320955 -55.33074,-64.663636c0.346909,0.342681 27.678961,-42.988622 27.332052,-43.331302c0.346909,0.342681 -26.985143,-18.989747 -27.332052,-19.332427c0.346909,0.34268 35.011951,-36.988903 34.665042,-37.331584c0.346909,0.34268 93.675869,29.674639 93.328959,29.331959c0.34691,0.34268 17.679431,37.007629 17.332521,36.664948c0.34691,0.342681 -36.984674,29.674639 -36.984674,29.674639z"
                        fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="#fff" />
                </a>
                <a id="land_7" onclick="select_land(this)" link='4,3,6,8'>
                    <path id="svg_2" d="m133.007357,195.000224c0,0 -15.99925,-65.996907 -16.346158,-66.339588c0.346908,0.342681 32.345408,-57.654601 31.9985,-57.997281c0.346908,0.34268 83.009701,13.008753 82.662792,12.666073c0.346909,0.34268 54.344379,37.674264 53.99747,37.331583c0.346909,0.342681 -26.318508,42.340713 -26.665417,41.998032c0.346909,0.342681 -66.316634,5.009129 -66.316634,5.009129c0,0 -33.331771,49.331021 -33.331771,49.331021c0,0 -25.998782,-21.998969 -25.998782,-21.998969z"
                        fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="#fff" />
                </a>
                <a id="land_8" onclick="select_land(this)" link='7,6,5'>
                    <path id="svg_9" d="m405.661246,33.674451c0,0 -137.326898,-5.999719 -137.326898,-5.999719c0,0 -62.66373,21.998969 -63.010639,21.656289c0.346909,0.34268 -18.985519,27.674733 -18.985519,27.674733c0,0 43.997938,5.999719 43.997938,5.999719c0,0 27.998688,18.665792 27.998688,18.665792c0,0 33.331771,-35.998313 33.331771,-35.998313c0,0 95.995501,29.331959 95.995501,29.331959c0,0 17.999156,-61.330459 17.999156,-61.330459z"
                        fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="#fff" />
                </a>
                <text xml:space="preserve" text-anchor="start" font-family="Arvo, sans-serif" font-size="16" id="svg_16" y="353.659455" x="53.677742"
                    fill-opacity="null" stroke-opacity="null" stroke-width="0" stroke="#000" fill="#000000">written by 温伟航</text>
                <!-- -->
                <a id='lord_slot_4' onclick="select_lord(this)">
                    <path id="svg_5" d="m132.10181,239.81139c-3.19516,2.5831 -7.61146,2.60817 -10.83089,0.07701c-3.09639,2.4353 -7.30167,2.50501 -10.46153,0.20905l-5.68185,6.10308c3.49514,3.82216 3.47482,9.96309 -0.05973,13.75905c-0.4691,1.29601 -0.71496,1.23352 -0.76613,2.53865c-0.12035,3.14223 0.58445,6.07353 2.79211,8.28123c1.97209,1.97209 4.64831,2.8085 7.21902,2.51007c4.29278,0.23823 6.35076,2.23517 7.2143,3.42956c1.16605,-1.27619 2.97936,-3.32782 8.49056,-3.58358c3.28995,-0.51005 4.47887,-1.33403 6.02292,-2.85743c2.07824,-2.07824 2.80493,-4.70992 2.74369,-7.63397c-0.02543,-1.21392 -0.16373,-1.63596 -0.84659,-3.18593c-3.55094,-3.81355 -3.55352,-9.99431 -0.00943,-13.81248l-5.82645,-5.83431z"
                        fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="#fff" />
                </a>
                <a id='lord_slot_7' onclick="select_lord(this)">
                    <path id="svg_10" d="m193.60012,105.81507c-3.19516,2.5831 -7.61146,2.60817 -10.83089,0.07701c-3.09639,2.43529 -7.30167,2.50501 -10.46153,0.20904l-5.68185,6.10308c3.49514,3.82216 3.47482,9.9631 -0.05973,13.75905c-0.46909,1.29601 -0.71495,1.23352 -0.76613,2.53865c-0.12035,3.14223 0.58445,6.07353 2.79211,8.28123c1.9721,1.97209 4.64831,2.8085 7.21902,2.51007c4.29278,0.23823 6.35077,2.23517 7.21431,3.42956c1.16605,-1.27619 2.97936,-3.32782 8.49056,-3.58358c3.28995,-0.51005 4.47887,-1.33403 6.02292,-2.85743c2.07824,-2.07824 2.80493,-4.70992 2.74368,-7.63397c-0.02543,-1.21392 -0.16373,-1.63595 -0.84659,-3.18592c-3.55094,-3.81355 -3.55353,-9.99431 -0.00943,-13.81248l-5.82645,-5.83431z"
                        fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="#fff" />
                </a>
                <a id='lord_slot_3' onclick="select_lord(this)">
                    <path id="svg_14" d="m244.59872,209.31223c-3.19516,2.5831 -7.61146,2.60817 -10.83089,0.07701c-3.09639,2.43529 -7.30167,2.50501 -10.46153,0.20904l-5.68185,6.10308c3.49514,3.82216 3.47482,9.9631 -0.05973,13.75905c-0.46909,1.29601 -0.71495,1.23352 -0.76613,2.53865c-0.12035,3.14223 0.58445,6.07353 2.79211,8.28123c1.9721,1.97209 4.64831,2.8085 7.21902,2.51007c4.29278,0.23823 6.35077,2.23517 7.21431,3.42956c1.16605,-1.27619 2.97936,-3.32782 8.49056,-3.58358c3.28995,-0.51005 4.47887,-1.33403 6.02292,-2.85743c2.07824,-2.07824 2.80493,-4.70992 2.74368,-7.63397c-0.02543,-1.21392 -0.16373,-1.63595 -0.84659,-3.18592c-3.55094,-3.81355 -3.55353,-9.99431 -0.00943,-13.81248l-5.82645,-5.83431z"
                        fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="#fff" />
                </a>
                <a id='lord_slot_0' onclick="select_lord(this)">
                    <path id="svg_15" d="m426.09372,279.81029c-3.19516,2.5831 -7.61146,2.60817 -10.83089,0.07701c-3.09639,2.43529 -7.30167,2.50501 -10.46153,0.20904l-5.68185,6.10308c3.49514,3.82216 3.47482,9.9631 -0.05973,13.75905c-0.46909,1.29601 -0.71495,1.23352 -0.76613,2.53865c-0.12035,3.14223 0.58445,6.07353 2.79211,8.28123c1.9721,1.97209 4.64831,2.8085 7.21902,2.51007c4.29278,0.23823 6.35077,2.23517 7.21431,3.42956c1.16605,-1.27619 2.97936,-3.32782 8.49056,-3.58358c3.28995,-0.51005 4.47887,-1.33403 6.02292,-2.85743c2.07824,-2.07824 2.80493,-4.70992 2.74368,-7.63397c-0.02543,-1.21392 -0.16373,-1.63595 -0.84659,-3.18592c-3.55094,-3.81355 -3.55353,-9.99431 -0.00943,-13.81248l-5.82645,-5.83431z"
                        fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="#fff" />
                </a>
                <a id='lord_slot_2' onclick="select_lord(this)">
                    <path id="svg_16" d="m377.59507,196.81257c-3.19516,2.5831 -7.61146,2.60817 -10.83089,0.07701c-3.09639,2.43529 -7.30167,2.50501 -10.46153,0.20904l-5.68185,6.10308c3.49514,3.82216 3.47482,9.9631 -0.05973,13.75905c-0.46909,1.29601 -0.71495,1.23352 -0.76613,2.53865c-0.12035,3.14223 0.58445,6.07353 2.79211,8.28123c1.9721,1.97209 4.64831,2.8085 7.21902,2.51007c4.29278,0.23823 6.35077,2.23517 7.21431,3.42956c1.16605,-1.27619 2.97936,-3.32782 8.49056,-3.58358c3.28995,-0.51005 4.47887,-1.33403 6.02292,-2.85743c2.07824,-2.07824 2.80493,-4.70992 2.74368,-7.63397c-0.02543,-1.21392 -0.16373,-1.63595 -0.84659,-3.18592c-3.55094,-3.81355 -3.55353,-9.99431 -0.00943,-13.81248l-5.82645,-5.83431z"
                        fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="#fff" />
                </a>
                <a id='lord_slot_6' onclick="select_lord(this)">
                    <path id="svg_17" d="m335.59623,113.31486c-3.19516,2.5831 -7.61146,2.60817 -10.83089,0.07701c-3.09639,2.43529 -7.30167,2.50501 -10.46153,0.20904l-5.68185,6.10308c3.49514,3.82216 3.47482,9.9631 -0.05973,13.75905c-0.46909,1.29601 -0.71495,1.23352 -0.76613,2.53865c-0.12035,3.14223 0.58445,6.07353 2.79211,8.28123c1.9721,1.97209 4.64831,2.8085 7.21902,2.51007c4.29278,0.23823 6.35077,2.23517 7.21431,3.42956c1.16605,-1.27619 2.97936,-3.32782 8.49056,-3.58358c3.28995,-0.51005 4.47887,-1.33403 6.02292,-2.85743c2.07824,-2.07824 2.80493,-4.70992 2.74368,-7.63397c-0.02543,-1.21392 -0.16373,-1.63595 -0.84659,-3.18592c-3.55094,-3.81355 -3.55353,-9.99431 -0.00943,-13.81248l-5.82645,-5.83431z"
                        fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="#fff" />
                </a>
                <a id='lord_slot_8' onclick="select_lord(this)">
                    <path id="svg_18" d="m267.0981,43.81678c-3.19516,2.5831 -7.61146,2.60817 -10.83089,0.07701c-3.09639,2.43529 -7.30167,2.50501 -10.46153,0.20904l-5.68185,6.10308c3.49514,3.82216 3.47482,9.9631 -0.05973,13.75905c-0.46909,1.29601 -0.71495,1.23352 -0.76613,2.53865c-0.12035,3.14223 0.58445,6.07353 2.79211,8.28123c1.9721,1.97209 4.64831,2.8085 7.21902,2.51007c4.29278,0.23823 6.35077,2.23517 7.21431,3.42956c1.16605,-1.27619 2.97936,-3.32782 8.49056,-3.58358c3.28995,-0.51005 4.47887,-1.33403 6.02292,-2.85743c2.07824,-2.07824 2.80493,-4.70992 2.74368,-7.63397c-0.02543,-1.21392 -0.16373,-1.63595 -0.84659,-3.18592c-3.55094,-3.81355 -3.55353,-9.99431 -0.00943,-13.81248l-5.82645,-5.83431z"
                        fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="#fff" />
                </a>
                <a id='lord_slot_5' onclick="select_lord(this)">
                    <path id="svg_19" d="m453.09299,83.31569c-3.19516,2.5831 -7.61146,2.60817 -10.83089,0.07701c-3.09639,2.43529 -7.30167,2.50501 -10.46153,0.20904l-5.68185,6.10308c3.49514,3.82216 3.47482,9.9631 -0.05973,13.75905c-0.46909,1.29601 -0.71495,1.23352 -0.76613,2.53865c-0.12035,3.14223 0.58445,6.07353 2.79211,8.28123c1.9721,1.97209 4.64831,2.8085 7.21902,2.51007c4.29278,0.23823 6.35077,2.23517 7.21431,3.42956c1.16605,-1.27619 2.97936,-3.32782 8.49056,-3.58358c3.28995,-0.51005 4.47887,-1.33403 6.02292,-2.85743c2.07824,-2.07824 2.80493,-4.70992 2.74368,-7.63397c-0.02543,-1.21392 -0.16373,-1.63595 -0.84659,-3.18592c-3.55094,-3.81355 -3.55353,-9.99431 -0.00943,-13.81248l-5.82645,-5.83431z"
                        fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="#fff" />
                </a>
                <a id='lord_slot_1' onclick="select_lord(this)">
                    <path id="svg_20" d="m479.09229,210.81219c-3.19516,2.5831 -7.61146,2.60817 -10.83089,0.07701c-3.09639,2.43529 -7.30167,2.50501 -10.46153,0.20904l-5.68185,6.10308c3.49514,3.82216 3.47482,9.9631 -0.05973,13.75905c-0.46909,1.29601 -0.71495,1.23352 -0.76613,2.53865c-0.12035,3.14223 0.58445,6.07353 2.79211,8.28123c1.9721,1.97209 4.64831,2.8085 7.21902,2.51007c4.29278,0.23823 6.35077,2.23517 7.21431,3.42956c1.16605,-1.27619 2.97936,-3.32782 8.49056,-3.58358c3.28995,-0.51005 4.47887,-1.33403 6.02292,-2.85743c2.07824,-2.07824 2.80493,-4.70992 2.74368,-7.63397c-0.02543,-1.21392 -0.16373,-1.63595 -0.84659,-3.18592c-3.55094,-3.81355 -3.55353,-9.99431 -0.00943,-13.81248l-5.82645,-5.83431z"
                        fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="#fff" />
                </a>
            </g>
        </svg>
    </center>
    <center>
        <div>
            <button onclick="test_finish_turn()">结束一个回合</button>
            <button onclick="test_get_player_info()">得到玩家信息</button>
            <button onclick="test_get_lord_info()">得到王国信息</button>
            <button onclick="test_do_expedition()">派兵远征</button>
        </div>
        <div>
            <h4>信息在这里</h4>
            <h5 id="info">xxxxxxxxx</h5>
        </div>
    </center>
</body>
<script>
    var last_select_land = null;
    var g_lands = new Array();
    //
    var MAX_LAND_NUM = 9;
    //地形 0~5 一共6种地形
    /*
        @ - 包含资源 （由高至低）
        # - 战斗影响
        平原：  @ 食物 棉花 水 木材         # 无               
        山地：  @ 矿石 硫磺 木材 食物       # 战斗方攻击降低 10%
        草地：  @ 棉花 食物 水              # 无
        冰原：  @ 水 矿石 木材              # 战斗方士气降低 10%，每回合额外消耗食物
        沙漠：  @ 矿石 硫磺                 # 战斗方士气降低 10%，每回合额外损失兵力
        沼泽：  @ 水 食物 木材 硫磺          # 行军速度降低50% 战斗方攻击降低 10%
    
    */
    var LAND_TYPES = new Array('平原', '山地', '草地', '冰原', '沙漠', '沼泽');
    var LAND_TYPE_COLORS = new Array('#FFFF99', '#999966', '#66cc00', '#ccffff', '#ffcc33', '#336699');
    //地形中，资源的增长值
    var LAND_RES_INCREASE = new Array(
        //以每回合增加10为峰值
        new Array(10, 0, 8, 0, 6, 4),
        new Array(0, 8, 0, 7, 6, 2),
        new Array(8, 0, 10, 0, 0, 6),
        new Array(0, 4, 0, 0, 4, 9),
        new Array(0, 3, 0, 2, 0, 0),
        new Array(3, 0, 0, 1, 2, 4),
    );
    //资源类型
    var RES_TYPES = new Array('食物', '矿石', '棉花', '硫磺', '木材', '水');
    //军备类型
    /*
        马匹：增加军团行军速度，在平原，草地，沙漠提升攻击力，在沼泽和冰原减少攻击力
        火枪：增加军团攻击力，减少 马匹 在战争中的额外效果，
        战争机器：无视防守方的额外加成
        防具：减少进攻方的攻击力
        服装：增加士气，在冰原上攻击力提升
        武器：增加军团攻击力
    */
    var ARMAMENT_TYPES = new Array('马匹', '火枪', '战争器械', '防具', '服装', '武器');
    //军备研发依赖{资源}的类型,以最大消耗 5 为最大值   [对于火枪和战争机械额外判断]
    var ARMAMENT_DEPEND = new Array(
        new Array(1, 0, 0, 0, 1, 2),
        new Array(0, 1, 1, 2, 3, 0),
        new Array(0, 3, 0, 0, 4, 0),
        new Array(0, 1, 1, 0, 2, 0),
        new Array(0, 0, 3, 0, 1, 0),
        new Array(0, 2, 0, 0, 3, 0)
    );
    //科技提升
    /*
        指南针：对整个领土有效，加强军团行军的速度
        火药：  可以在军备中战争火枪
        造纸术：可以在军备中研发战争机械
        印刷术：可以使城镇幸福指数升高，征兵比例提升
    */
    var TECH_TYPES = new Array('无科技', '指南针', '火药', '造纸术', '印刷术');
    //王国 一共有4个,其中0位置是默认无王国的
    var LORD_COLORS = new Array('#eeeeee', '#333333', '#cc3366', '#339966', '#0099cc');
    /*基础比例常量*/
    //征兵
    var CONSCRIPTION_RATE = 0.1;
    //最大王国数目
    var LORD_MAX_NUM = 4;
    //初始王国数目
    var INIT_LORD_NUM = 2;
    //初始玩家数目
    var INIT_PLAYER_NUM = 2;
    //城镇派出军团的限制，仅当所派出的军团到达目的地，或者消亡后，才可以继续远征
    var LORD_MATCH_LIMIT = 3;
    //每回合每个士兵消耗的补给
    var COST_SUPPLY = 0.1;
    //当补给不足时，每回合死亡的军队数目比列
    var FAMINE_DEAD = 0.05; //意味着，在没有补给的情况下，可以坚持20回合，哈哈
    var FAMINE_DEAD_CONST = 10; //饥饿情况下固定死亡常数
    var FAMINE_LOSE_MORALE = 5; //饥荒下，士气值每回合损失
    //王国人口数目上限
    var POPULATION_LIMIT = 5000;
    //触发损失幸福值的基数值
    var LOST_HAPPINESS_BASE = 10;
    //损失幸福指数比例范围
    var LOST_HAPPINESS_RANGE = {
        min: 0.02,
        max: 0.1
    };
    //幸福值增长数目
    var HAPPINESS_INC = 5;
    //
    var MORALE_2_HAPPINESS = 10;
    /////////////
    var random_range = function(min, max) {
        if (max == null) {
            max = min;
            min = 0;
        }
        return min + Math.floor(Math.random() * (max - min + 1));
    };
    //玩家管理器
    var g_PlayerManager = null;
    /*-------------------
        游戏对象的定义
    --------------------*/
    function Land(id, name, neighbor, land_type, lord) {
        this.id = id; //地形ID
        this.name = name; //地形名称
        this.neighbor = neighbor; //相邻地形
        this.land_type = land_type; //地形类型
        this.lord = lord || new Lord(); //此地形的领主
    }

    function Lord(mother, owner, p, h) {
        this.motherland = mother || null; //所属大陆地形
        this.owner = owner || 0; //所属玩家,玩家ID
        this.population = p || 0; //人口
        this.happiness = h || 0; //幸福度，影响人口的增长比率
        this.matching_legion = new Array(3); //远征部队
        this.techs = 0; //默认选择一个开始科技
        this.state = 0; //此王国的状态  0 空闲，1 已经行动完毕，2被锁定
        this.res = new Array(RES_TYPES.length); //此王国初始有什么资源
        //---------------------一些隐藏的因素因子
        this.beConscripted = 0; //被征兵次数
        //
        this.init = function(mother, p, h) {
            this.motherland = mother;
            this.population = p;
            this.happiness = h;
        };
        this.setOwner = function(o) {
            this.owner = o;
        };
        this.hasOwner = function() {
            return this.owner != 0;
        };
        this.getID = function() {
            return this.motherland.id;
        };
        this.getMaxConscriptNum = function() {
            return this.population * CONSCRIPTION_RATE;
        };
        this.doneAction = function() {
            this.state = 1;
        };
        this.locked = function() {
            this.state = 2;
        };
        //融合一个远征军
        this.absorbLegion = function(lg) {
            if (this.owner == lg.owner) {
                this.population = Math.min(this.population + lg.num, POPULATION_LIMIT);
                this.res[0] += lg.supply;
                this.happiness += lg.moraleToHappiness();
                ls.destory();
            } else {
                //开始攻击
            }
        };
        //损失一个远征军
        this.lostLegion = function(lg) {

        };
        //行动-派军远征
        this.expedition = function(n, s, dest) {
            this.matching_legion.forEach(lg => {
                if (lg.isActive == false && n <= this.getMaxConscriptNum() && s <= this.res[0] && dest <=
                    g_lands.length) {
                    lg.reset(n, 1, s, dest.this.owner);
                    this.population -= n;
                    this.res[0] -= s;
                    this.beConscripted++;
                    //如果小于，则触发损失幸福值
                    if (random_range(0, LOST_HAPPINESS_BASE) < this.beConscripted) {
                        this.happiness -= (this.happiness * random_range(LOST_HAPPINESS_RANGE.min,
                            LOST_HAPPINESS_RANGE.max));
                        if (this.happiness < 0) {
                            this.happiness = 0;
                        }
                    }
                }
            });
        };
        //行动-发展王国
        this.develop = function() {
            for (var i = 0; i < this.res.length; ++i) {
                this.res[i] += LAND_RES_INCREASE[this.motherland.land_type][i];
            }
            this.happiness += HAPPINESS_INC;
        };
        //行动-研发军备
        this.research = function() {

        };
        //
        this.finishTurn = function() {
            this.state = 0;
        }

    }

    function Legion(n, m, s, owner) {
        this.num = n || 0; //部队数目
        //其中,数组中的每个元素,就是这个军团的军备数目
        this.armaments = new Array(ARMAMENT_TYPES.length);
        this.morale = m || 1; //士气 
        this.supply = s || 0; //补给
        this.isActive = false; //是否是激活状态
        this.destLand = -1; //目的大陆
        this.owner = owner; //所属玩家
        //死亡数目
        this.dead_num = 0;
        //---
        this._finishTurn = function() {
            //当补给不足时，部队死亡部分
            if (this.supply < 0 && this.isActive) {
                this.dead_num = this.num * FAMINE_DEAD + FAMINE_DEAD_CONST;
                this.num -= this.dead_num;
                this.morale = Math.max(0, this.morale - FAMINE_LOSE_MORALE);
                if (this.num <= 0) {
                    this.destory();
                }
            }
            this.supply -= this.COST_SUPPLY * this.num;
        };
        //
        this.destory = function() {
            this.isActive = false;
        };
        //
        this.reset = function(n, m, s, d, o) {
            this.isActive = true;
            this.num = n;
            this.morale = m;
            this.supply = s;
            this.dead_num = 0;
            this.destLand = d; //目的大陆
            this.owner = o;
        };
        //
        this.moraleToHappiness = function() {
            return (this.morale - 1) * MORALE_2_HAPPINESS;
        };
        //
        this.goMatching = function() {

        }
    }

    //
    //  玩家
    //
    function Player(id, t) {
        this.playerID = id;
        this.isRealPlayer = true;
        this.playerType = t || 0; //0 是地图上的非中立玩家;1 是地图上的中立玩家
        this.enableAI = function() {
            this.isRealPlayer = false;
        };
        this.getLords = function() {
            var ret = new Array();
            g_lands.forEach(element => {
                if (element.lord.owner == this.playerID) {
                    ret.push(element.lord);
                }
            });
            return ret;
        };
        this.getLands = function() {
            var ret = new Array();
            g_lands.forEach(element => {
                if (element.lord.owner == this.playerID) {
                    ret.push(element);
                }
            });
            return ret;
        };
        //
        this.finishTurn = function() {
            var lords = this.getLords();
            lords.forEach(lord => {
                lord.finishTurn();
            });
        };
        //
        this.think = function() {
            alert("AI thinked!");
        }
    }

    function PlayerManager() {
        this.players = new Array(INIT_PLAYER_NUM + 1);
        this.curPlayer = 0;
        this.initManager = function() {
            this.players[0] = new Player(1); //默认是无玩家，或者是中立玩家
            for (var i = 1; i < this.players.length; i++) {
                this.players[i] = new Player(i);
            }
        };
        this.getPlayer = function(idx) {
            return this.players[idx];
        };
        this.nextPlayer = function() {
            this.curPlayer++;
            if (this.curPlayer < this.players.length) {
                return this.getPlayer[this.curPlayer];
            }
            return null;
        }
        this.finishTurn = function() {
            this.curPlayer = 0;
            this.players.forEach(player => {
                player.finishTurn();
            });
        }
    };
    //

    ///////////////////////////////////////
    //
    //      Game相关
    //
    ////////////////////////////////////////
    window.onload = function() {
        g_PlayerManager = new PlayerManager();
        g_PlayerManager.initManager();
        //
        random_world();
        refresh_world();
    }

    function random_world() {
        for (var i = 0; i < MAX_LAND_NUM; ++i) {
            var lt = parseInt(Math.random() * 100) % LAND_TYPES.length;
            var land_block = document.getElementById('land_' + i.toString());
            var dests = land_block.getAttribute('link').split(',');
            var links = new Array();
            dests.forEach(n => {
                links.push(parseInt(n));
            });
            var land = new Land(i, 'land_' + i, links, lt);
            land.lord.init(land, 1000, 100);
            g_lands.push(land);
        }

        for (var i = 1; i <= INIT_LORD_NUM; ++i) {
            var lt = parseInt(Math.random() * 100) % MAX_LAND_NUM;
            if (!g_lands[lt].lord.hasOwner()) {
                g_lands[lt].lord.setOwner(i);
            } else {
                i--;
            }
        }
    }

    function refresh_world() {
        for (var i = 0; i < MAX_LAND_NUM; ++i) {
            document.getElementById('land_' + i.toString()).firstElementChild.setAttribute('fill', LAND_TYPE_COLORS[
                g_lands[i].land_type]);
            var lord_slot = document.getElementById('lord_slot_' + i.toString());
            lord_slot.firstElementChild.setAttribute('fill', LORD_COLORS[g_lands[i].lord.owner]);
        }
    }

    function select_lord(item) {
        alert(g_lands[parseInt(item.id.split('_')[2])].lord.owner);
    }

    function select_land(item) {
        if (last_select_land) {
            last_select_land.firstElementChild.removeAttribute("filter");
        }
        item.firstElementChild.setAttribute("filter", "url(#fx_offset)");
        last_select_land = item;
        //
        console.log(get_land(item.id));
    }

    function get_land(item_id) {
        return g_lands[parseInt(item_id.split('_')[1])];
    }

    function get_last_select_land() {
        var id = last_select_land.id;
        return (get_land(id));
    }
    /*
        测试用
    */
    function test_finish_turn() {

    }

    function test_get_player_info() {
        var info = document.getElementById('info');
        var last_select_land
        info.innerText = "info:" + g_PlayerManager.getPlayer(1);
    }

    function test_get_lord_info() {
        var land = get_last_select_land;
    }

    function test_do_expedition() {

    }
</script>

</html>